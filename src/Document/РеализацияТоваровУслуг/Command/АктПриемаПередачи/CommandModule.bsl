&НаСервере
Функция ПолучитьСтруктуруДанных(СсылкаНаОбъект)
	КолДней = 1;
	Если ЗначениеЗаполнено(СсылкаНаОбъект.ЗаказКлиента) Тогда
		Если ЗначениеЗаполнено(СсылкаНаОбъект.ЗаказКлиента.ДокументОснование) Тогда
			Если ЗначениеЗаполнено(СсылкаНаОбъект.ЗаказКлиента.ДокументОснование.АК_УсловияПоставки) Тогда
				 КолДней = СсылкаНаОбъект.ЗаказКлиента.ДокументОснование.АК_УсловияПоставки.КоличествоДней;				
			КонецЕсли;			
		КонецЕсли;
	КонецЕсли;
	
	УстановитьПривилегированныйРежим(Истина);
	СтруктураРезультата = новый Структура;
	СтруктураРезультата.Вставить("НомерДоговора",СсылкаНаОбъект.НомерДоговора);
	СтруктураРезультата.Вставить("ДатаДокумента",Формат(СсылкаНаОбъект.Дата,"ДЛФ=DD"));
	СтруктураРезультата.Вставить("КонтактноеЛицо",СсылкаНаОбъект.КонтактноеЛицо.Наименование);
	СтруктураРезультата.Вставить("КонтактноеЛицоДолжность",СсылкаНаОбъект.КонтактноеЛицо.ДолжностьПоВизитке);
	СтруктураРезультата.Вставить("СуммаДокумента",Строка(СсылкаНаОбъект.СуммаДокумента) + "("+ РаботаСКурсамиВалют.СформироватьСуммуПрописью(СсылкаНаОбъект.СуммаДокумента, СсылкаНаОбъект.Валюта)+" ) ");
	СтруктураРезультата.Вставить("ДатаВыполения",Формат(СсылкаНаОбъект.Дата + КолДней*86400,"ДЛФ=DD"));
	СтруктураРезультата.Вставить("Контрагент",СсылкаНаОбъект.Партнер.НаименованиеПОлное);
	
	Возврат СтруктураРезультата;
КонецФункции

&НаСервере
Функция ПолучитьСсылкуНаФайлДоговора()
	Возврат Справочники.Файлы.НайтиПоНаименованию("Прием_передача");
КонецФункции

&НаКлиенте
Процедура ОбработкаКоманды(ПараметрКоманды, ПараметрыВыполненияКоманды)
	
	//Если УправлениеПечатьюКлиент.ПроверитьДокументыПроведены(ПараметрКоманды, ПараметрыВыполненияКоманды.Источник) Тогда
	
	Для Каждого СсылкаНаОбъект Из ПараметрКоманды Цикл
		//Получаем файл из предопределенного 
		ДанныеФайла = РаботаСФайламиСлужебныйВызовСервера.ПолучитьДанныеФайлаИДвоичныеДанные(
		ПолучитьСсылкуНаФайлДоговора());
		ДвоичныеДанные = ДанныеФайла.ДвоичныеДанные;
		ИмяФайла = ПолучитьИмяВременногоФайла("doc");
		ДвоичныеДанные.Записать(ИмяФайла);
		
		//РаботаСФайламиКлиент.СоздатьФайл(
		Попытка  
			КомОбъект = Новый COMОбъект("Word.Application");    
			Документ =КомОбъект.Documents.Add(ИмяФайла);				
		Исключение   
			Сообщить(ОписаниеОшибки());
			//если ошибка 
			КомОбъект.Application.Quit();				
			Сообщить("Произошла ошибка открытия файла Microsoft Word", СтатусСообщения.Важное);
			Возврат;
		КонецПопытки;
		СтруктураДанных = ПолучитьСтруктуруДанных(СсылкаНаОбъект);
		//замена шаблона <[ИмяПараметра]> в документе ворд, на параметры данных
		попытка
			Для Каждого текЭлемент Из СтруктураДанных Цикл
				Для сч=1 по 10 цикл
					Замена = Документ.Content.Find;
					Замена.Execute("["+текЭлемент.Ключ+"]", Ложь, Истина, Ложь, , , Истина, , Ложь, Лев(Строка(текЭлемент.Значение),250));
				КонецЦикла;
			КонецЦикла;
			
			КомОбъект.Visible = True;	
		Исключение 				
			Сообщить(ОписаниеОшибки()); 				
			КомОбъект.Application.Quit(); 
		КонецПопытки;						
	КонецЦикла;	
	
	//КонецЕсли;
	
КонецПроцедуры

