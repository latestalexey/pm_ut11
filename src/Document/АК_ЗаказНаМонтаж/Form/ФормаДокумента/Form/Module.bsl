
&НаСервере
Процедура ЗаполнитьПоУмолчанию()
	
	Если Не ЗначениеЗаполнено(Объект.Ответственный) Тогда
		Объект.Ответственный = ПараметрыСеанса.ТекущийПользователь;
	КонецЕсли; 
	
КонецПроцедуры

&НаКлиенте
Процедура Заполнить(Команда)    
	
	ФормаВыбора = ПолучитьФорму("Документ.ЗаказКлиента.Форма.АК_ФормаСпискаДокументовВыбор");

	ЭлементОтбора = ФормаВыбора.Список.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
    ЭлементОтбора.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("Партнер");
    ЭлементОтбора.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
    ЭлементОтбора.Использование = Истина;
    ЭлементОтбора.ПравоеЗначение = Объект.Заказчик;
	ФормаВыбора.Элементы.Список.МножественныйВыбор = Истина;
	ФормаВыбора.Элементы.Список.РежимВыделения  = РежимВыделенияТаблицы.Множественный;
	
	ФормаВыбора.ЗакрыватьПриВыборе = Истина;
	
    ФормаВыбора.Элементы.Список.Обновить();
	
	Результат = ФормаВыбора.ОткрытьМодально();
	
	Если Результат <> Неопределено Тогда
		ЗаполнитьЗаказы(Результат);		
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ЗаполнитьЗаказы(Результат)
	ТекОбъект = РеквизитФормыВЗначение("Объект");
	ТекОбъект.ЗаполнитьЗаказыСервер(Результат);
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	ДополнительныеОтчетыИОбработки.ПриСозданииНаСервере(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	
	ЗаполнитьПоУмолчанию();
	
КонецПроцедуры

&НаСервере
Функция ПолучитьСписокПунктов(Партнер)
	
	СписокПунктов = Новый Массив;
	
	Запрос = Новый Запрос;
	Запрос.Текст = 
		"ВЫБРАТЬ
	|	ПартнерыАК_ПунктыНазначения.ПунктНазначения
	|ИЗ
	|	Справочник.Партнеры.АК_ПунктыНазначения КАК ПартнерыАК_ПунктыНазначения
	|ГДЕ
	|	ПартнерыАК_ПунктыНазначения.Ссылка = &Партнер";
	
	Запрос.УстановитьПараметр("Партнер", Партнер);
	
	Результат = Запрос.Выполнить();
	Выборка = Результат.Выбрать();
	
	Пока Выборка.Следующий() Цикл
	
		СписокПунктов.Добавить(Выборка.ПунктНазначения);
	
	КонецЦикла;
	
	Возврат СписокПунктов;
	
КонецФункции

&НаКлиенте
Процедура АдресНачалоВыбораИзСписка(Элемент, СтандартнаяОбработка)
	
	СписокПунктов = ПолучитьСписокПунктов(Объект.Партнер);
	Элемент.СписокВыбора.ЗагрузитьЗначения(СписокПунктов);
	
КонецПроцедуры

                                                 
             