////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("АвтоТест") Тогда // Возврат при получении формы для анализа.
		Возврат;
	КонецЕсли;
	
	Элементы.СостояниеРегистра.Заголовок = ПолучитьСостояниеАдресногоКлассификатора(ЭтаФорма);
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработкаОповещения(ИмяСобытия, Параметр, Источник)
	
	Если ИмяСобытия = "Запись_АдресныйКлассификатор" Тогда
		Элементы.СостояниеРегистра.Заголовок = ПолучитьСостояниеАдресногоКлассификатораНаСервере();
	КонецЕсли;
	
КонецПроцедуры


////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

&НаСервере
Функция ПолучитьСостояниеАдресногоКлассификатораНаСервере()
	
	Возврат ПолучитьСостояниеАдресногоКлассификатора(ЭтаФорма);
	
КонецФункции

&НаСервереБезКонтекста
Функция ПолучитьСостояниеАдресногоКлассификатора(Контекст)
	
	ЧислоЗаполненныхАдресныхОбъектов = АдресныйКлассификатор.ЧислоЗаполненныхАдресныхОбъектов();
	Если ЧислоЗаполненныхАдресныхОбъектов > 0 Тогда
		Заголовок = 
				СтроковыеФункцииКлиентСервер.ПодставитьПараметрыВСтроку(
							НСтр("ru = 'Объектов в адресном классификаторе: %1.'"),
							Строка(ЧислоЗаполненныхАдресныхОбъектов));
		Контекст.Элементы.ПроверитьОбновление.Доступность = Истина;
	Иначе
		Заголовок = НСтр("ru = 'Адресный классификатор не заполнен.'");
		Контекст.Элементы.ПроверитьОбновление.Доступность = Ложь;
	КонецЕсли;
	
	Возврат Заголовок;
	
КонецФункции

&НаКлиенте
Процедура ЗагрузитьАдресныйКлассификатор(Команда)
	
	АдресныйКлассификаторКлиент.ЗагрузитьАдресныйКлассификатор();
	
КонецПроцедуры

&НаКлиенте
Процедура ОчиститьАдресныйКлассификатор(Команда)
	
	АдресныйКлассификаторКлиент.ОчиститьКлассификатор();
	
КонецПроцедуры

&НаКлиенте
Процедура ПроверитьОбновлениеАдресногоКлассификатора(Команда)
	
	АдресныйКлассификаторКлиент.ОпределитьНеобходимостьОбновленияАдресныхОбъектов();
	
КонецПроцедуры



