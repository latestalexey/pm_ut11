
///////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Элементы.ГруппаНастройки.Видимость = НЕ Параметры.ЭтоРасшифровка;
	Отчет.ПериодРасшифровки = Параметры.ПериодРасшифровки;
КонецПроцедуры

&НаСервере
Процедура ПриЗагрузкеВариантаНаСервере(Настройки)
	
	Отчет.ВыбранныйВариант = НаименованиеТекущегоВарианта;
	
КонецПроцедуры

///////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ШАПКИ ФОРМЫ

&НаКлиенте
Процедура РезультатОбработкаРасшифровки(Элемент, Расшифровка, СтандартнаяОбработка)
	ТипРасшифровки = ТипЗнч(Расшифровка);
	СтандартнаяОбработка = НужнаСтандартнаяРасшифровка(ТипРасшифровки);
	Если НЕ СтандартнаяОбработка Тогда
		Если ТипРасшифровки = Тип("Структура") Тогда
			Если Расшифровка.ИмяГруппировки = "ВидНоменклатуры"
				ИЛИ Расшифровка.ИмяГруппировки = "ТоварнаяКатегория" Тогда
				
				НовыеНастройки = Неопределено;
				КопироватьИДополнитьНастройки(НовыеНастройки, Расшифровка);
				
				ПараметрыОткрытия = Новый Структура;
				ПараметрыОткрытия.Вставить("ПериодРасшифровки", Расшифровка.Период);
				ПараметрыОткрытия.Вставить("ФиксированныеНастройки", НовыеНастройки);
				ПараметрыОткрытия.Вставить("ЭтоРасшифровка", Истина);
				ПараметрыОткрытия.Вставить("ИмяГруппировкиРасшифровки", Расшифровка.ИмяГруппировки);
				ПараметрыОткрытия.Вставить("КлючВарианта", "ПоКатегорииКонтекст");
				ПараметрыОткрытия.Вставить("СформироватьПриОткрытии", Истина);
				ОткрытьФорму(
					"Отчет.АнализИсполненияАссортимента.Форма",
					ПараметрыОткрытия,
					ЭтаФорма,
					Истина,
					);
			КонецЕсли;
		КонецЕсли;
	КонецЕсли;
КонецПроцедуры

///////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

&НаСервере
Функция НужнаСтандартнаяРасшифровка(ТипРасшифровки)
	
	Возврат Справочники.ТипВсеСсылки().СодержитТип(ТипРасшифровки);
	
КонецФункции

&НаСервере
Процедура КопироватьИДополнитьНастройки(НовыеНастройки, Расшифровка)
	
	НовыеНастройки = Отчет.КомпоновщикНастроек.ПолучитьНастройки();
	ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(
		НовыеНастройки.Отбор,
		"Магазин",
		Расшифровка.Магазин,
		ВидСравненияКомпоновкиДанных.Равно,
		,
		Истина);
	
	Если Расшифровка.ИмяГруппировки = "ВидНоменклатуры" Тогда
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(
			НовыеНастройки.Отбор,
			"ВидНоменклатуры",
			Расшифровка.ВидНоменклатуры,
			ВидСравненияКомпоновкиДанных.Равно,
			,
			Истина);
	Иначе
		ОбщегоНазначенияКлиентСервер.УстановитьЭлементОтбора(
			НовыеНастройки.Отбор,
			"ТоварнаяКатегория",
			Расшифровка.ТоварнаяКатегория,
			ВидСравненияКомпоновкиДанных.Равно,
			,
			Истина);
	КонецЕсли;
	
КонецПроцедуры


