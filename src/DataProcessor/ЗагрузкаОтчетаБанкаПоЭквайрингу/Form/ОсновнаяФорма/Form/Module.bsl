////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ФОРМЫ

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	
	УстановитьДоступ();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ СОБЫТИЙ ЭЛЕМЕНТОВ ШАПКИ ФОРМЫ

&НаКлиенте
Процедура XMLФайлНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	
	ДиалогВыбораФайла.Фильтр                      = НСтр("ru='XML файл (*.xml)|*.xml'");
	ДиалогВыбораФайла.Заголовок                   = "Выберите XML файл";
	ДиалогВыбораФайла.ПредварительныйПросмотр     = Ложь;
	ДиалогВыбораФайла.Расширение                  = "xml";
	ДиалогВыбораФайла.ИндексФильтра               = 0;
	ДиалогВыбораФайла.ПолноеИмяФайла              = Элемент.ТекстРедактирования;
	ДиалогВыбораФайла.ПроверятьСуществованиеФайла = Ложь;
	
	Если ДиалогВыбораФайла.Выбрать() Тогда
		XMLФайл = ДиалогВыбораФайла.ПолноеИмяФайла;
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура XMLФайлОткрытие(Элемент, СтандартнаяОбработка)
	
	СтандартнаяОбработка = Ложь;
	
	Если ЗначениеЗаполнено(Элемент.ТекстРедактирования) Тогда
		
		Файл = Новый Файл(Элемент.ТекстРедактирования);
		
		Если НЕ Файл.Существует() Тогда
			ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru='Не найден XML файл с данными!'"),
			Объект, "XMLФайл");
			Возврат;
		КонецЕсли;
					
		ПараметрыФормы = Новый Структура;
		ПараметрыФормы.Вставить("XMLФайл", Элемент.ТекстРедактирования);
		
		ФормаXMLДокумента = ПолучитьФорму("Обработка.ЗагрузкаОтчетаБанкаПоЭквайрингу.Форма.ФормаXMLДокумента", ПараметрыФормы, ЭтаФорма);
		
		ФормаXMLДокумента.Открыть();
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура СтатьяРасходовПриИзменении(Элемент)
		
	УстановитьДоступ();
	
КонецПроцедуры

&НаКлиенте
Процедура СтатьяРасходовОчистка(Элемент, СтандартнаяОбработка)
	
	АналитикаРасходов = "";
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// ОБРАБОТЧИКИ КОМАНД ФОРМЫ

&НаКлиенте
Процедура Загрузить(Команда)
	
	Если НЕ ЭтаФорма.ПроверитьЗаполнение() Тогда
		Возврат;
	КонецЕсли;
		
	Файл = Новый Файл(XMLФайл);
		
	Если НЕ Файл.Существует() Тогда
		ОбщегоНазначенияКлиентСервер.СообщитьПользователю(НСтр("ru='Не найден XML файл с данными!'"),
                               							  Объект, "XMLФайл");
		Возврат;
	КонецЕсли;
	
	Адрес = "";
	
	ПоместитьФайл(Адрес, XMLФайл, , Ложь, Новый УникальныйИдентификатор);
	
	ЗагрузитьСервер(Адрес);
		
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

////////////////////////////////////////////////////////////////////////////////
// Прочее

&НаСервере
Процедура ЗагрузитьСервер(Адрес)
		
	Обработки.ЗагрузкаОтчетаБанкаПоЭквайрингу.ЗагрузитьXMLФайлВИнформационнуюБазуСервер(Объект, XMLФайл, ПроводитьДокументыПриЗагрузке, СтатьяРасходов, АналитикаРасходов, Подразделение, Адрес);
		
КонецПроцедуры

&НаКлиенте
Процедура УстановитьДоступ()
	
	Элементы.АналитикаРасходов.ТолькоПросмотр = НЕ ЗначениеЗаполнено(СтатьяРасходов);
	
КонецПроцедуры
