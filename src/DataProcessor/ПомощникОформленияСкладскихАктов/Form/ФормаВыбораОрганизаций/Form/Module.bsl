
&НаКлиенте
Процедура ДобавитьОрганизацию(Команда)
	ТекущиеДанные = Элементы.Организации.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено Тогда
		ОрганизацияСсылка = ТекущиеДанные.Организация;
		
		НайденныеСтроки = Объект.ВыбранныеОрганизации.НайтиСтроки(Новый Структура("Организация", ОрганизацияСсылка));
		
		Если НайденныеСтроки.Количество() > 0 Тогда
			Возврат;
		КонецЕсли;
		
		НоваяСтрока = Объект.ВыбранныеОрганизации.Добавить();
		НоваяСтрока.Организация = ОрганизацияСсылка;
		
	КонецЕсли;
КонецПроцедуры

&НаКлиенте
Процедура УдалитьОрганизацию(Команда)
	ТекущиеДанные = Элементы.ВыбранныеОрганизации.ТекущиеДанные;
	Если ТекущиеДанные <> Неопределено Тогда
		Объект.ВыбранныеОрганизации.Удалить(ТекущиеДанные);
	КонецЕсли;
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	// Пропускаем инициализацию, чтобы гарантировать получение формы при передаче параметра "АвтоТест".
	Если Параметры.Свойство("АвтоТест") Тогда
		Возврат;
	КонецЕсли;
	
	СтруктураТаблиц = ПолучитьИзВременногоХранилища(Параметры.АдресОрганизаций);
	
	Объект.Организации.Загрузить(СтруктураТаблиц.Организации);
	Объект.ВыбранныеОрганизации.Загрузить(СтруктураТаблиц.ВыбранныеОрганизации);
	
	АдресВХранилище = Параметры.АдресОрганизаций;	
	
КонецПроцедуры

Процедура ПоместитьОрганизацииВоВременноеХранилище()
	ПоместитьВоВременноеХранилище(Объект.ВыбранныеОрганизации.Выгрузить(),АдресВХранилище);	
КонецПроцедуры

&НаКлиенте
Процедура ОК(Команда)
	ПоместитьОрганизацииВоВременноеХранилище();
	Закрыть(КодВозвратаДиалога.ОК);
КонецПроцедуры

&НаКлиенте
Процедура ДобавитьВсеОрганизации(Команда)
	Объект.ВыбранныеОрганизации.Очистить();
	Для Каждого СтрТабл из Объект.Организации Цикл
		ЗаполнитьЗначенияСвойств(Объект.ВыбранныеОрганизации.Добавить(), СтрТабл);
	КонецЦикла;
КонецПроцедуры

&НаКлиенте
Процедура УдалитьВсеОрганизации(Команда)
	Объект.ВыбранныеОрганизации.Очистить();
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеОрганизацииПередНачаломДобавления(Элемент, Отказ, Копирование, Родитель, Группа)
	Отказ = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеОрганизацииПередНачаломИзменения(Элемент, Отказ)
	Отказ = Истина;
КонецПроцедуры

&НаКлиенте
Процедура ОрганизацииВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	ДобавитьОрганизацию(Неопределено);
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеОрганизацииВыбор(Элемент, ВыбраннаяСтрока, Поле, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
КонецПроцедуры

&НаКлиенте
Процедура ВыбранныеОрганизацииПеретаскивание(Элемент, ПараметрыПеретаскивания, СтандартнаяОбработка, Строка, Поле)
	ДобавитьОрганизацию(Неопределено);
КонецПроцедуры

&НаКлиенте
Процедура ОрганизацииПеретаскивание(Элемент, ПараметрыПеретаскивания, СтандартнаяОбработка, Строка, Поле)
	УдалитьОрганизацию(Неопределено);
КонецПроцедуры


&НаКлиенте
Процедура ОрганизацииПередНачаломИзменения(Элемент, Отказ)
	Отказ = Истина;
КонецПроцедуры

